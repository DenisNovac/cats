# Scala application lifecycle

Оригинал: https://blog.softwaremill.com/scala-application-lifecycle-from-pure-scala-to-fs2-5f2861005603

Во время запуска программы есть множество типичных операций, которые должны быть выполнены. Приложение должно загрузить конфигурацию, соединения с БД должны быть созданы, HTTP-клиенты (мониторинг, брокеры) - подключены. Все открытые ресурсы должны быть закрыты после этого.

Cats Effect позволяет инкапсулировать любые побочные эффекты в IO тип. `IO[String]` означает, что как только запускается IO, результат должен быть String. Но без явного запуска этого не произойдёт, всё внутри IO - ленивое. Поэтому IO это что-то вроде ленивого Future. 

Классы `Resource` и `Bracket` позволяют безопасно использовать ресурсы, требующие открытия и закрытия. Они оборачивают их и после вызова `use` закрывают. Попросту нет возможности получить что-то, не закрыв ресурс.

`Resource` и `Bracket` отличаются, хотя `Resource` и построен на `Bracket`. У `Bracket` есть три стадии - получение ресурса, использование и освобождение (каждая стадия - `IO`). Но в `Bracket` есть проблема: если использование бросило ошибку, то освобождение не наступает (это обходится вызовом одного Bracket внутри другого, что и предоставляет Resource "под капотом"). 

Ещё Cats Effect предоставляет дополнительный класс `IOApp`, который возвращает `IO` из всего приложения, что означает, что всё приложение обёрнуто. Так его можно встраивать в другие приложения.